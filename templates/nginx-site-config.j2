server {
  listen 443 ssl;
{% if not ssl %}  listen 80;
{% endif %}

  server_name {{ domain }}{% if www_domain %} {{ www_domain }}{% endif %};

  {% if redirect_domain %}
  rewrite ^/?(.*)$ https://{{ redirect_domain }}/$1 permanent;
  {% else %}
  root /var/www/{{ domain }}/htdocs;
  index index.html index.htm;
  {% endif %}

  location / {
    try_files $uri $uri/ =404;
  }

{% if ssl %}
  ssl on;
  ssl_certificate /etc/letsencrypt/live/{{ domain }}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/{{ domain }}/privkey.pem;
{% endif %}

  error_log /var/www/{{ domain }}/logs/error.log warn;
  access_log /var/www/{{ domain }}/logs/access.log combined;
}

# vim: expandtab:ts=2:sw=2:ft=conf
